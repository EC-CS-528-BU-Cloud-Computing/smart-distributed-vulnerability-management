package generator

import (
	"fmt"
	"os"
	"os/exec"
	"path/filepath"

	"github.com/everfix/pkg/config"
	"github.com/tap8stry/orion/pkg/common"
)

func GenerateSBOM(image string, source string, format string) {
	cmd := exec.Command("syft", "packages", filepath.Join(source, image), "-o", format)
	out, err := cmd.Output()
	if err != nil {
		fmt.Println("Error generating SBOM: ", err)
	} else {
		fmt.Println(filepath.Join(config.SBOM_DIR, image+".json"))
		os.WriteFile(filepath.Join(config.SBOM_DIR, image+".json"), out, 0666)
	}
}

func GenerateSBOMFromImage(image common.Image, source string, format string) {
	name := image.Name
	tag := image.Tag
	imageStr := name + ":" + tag
	GenerateSBOM(imageStr, source, format)
}
