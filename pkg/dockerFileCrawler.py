import requests
import argparse

if __name__ == '__main__':
    
    #parse user input
    parser = argparse.ArgumentParser()
    parser.add_argument("--name", help="Name of the image")
    parser.add_argument("--version", help="Version of the image")
    
    args = parser.parse_args()
    
    # get json file from docker hub
    docker = requests.get("https://hub.docker.com/v2/repositories/library/"+args.name+"/")
    docker_text = docker.text
    
    # find the github raw link to the specified version of the image
    version_pos = docker_text.find(args.version)
    docker_text = docker_text[version_pos:]
    git_start_pos = docker_text.find('(')
    docker_text = docker_text[git_start_pos+1:]
    git_end_pos = docker_text.find(')')
    git_url = docker_text[:git_end_pos]
    raw_url = git_url.replace('/blob', '')
    raw_url = raw_url.replace("https://github.com", "https://raw.githubusercontent.com")
    
    # get docker file content
    raw_content = requests.get(raw_url)
    
    # Save the dockerfile content to local file
    with open("../dockerfile/NewDockerfile", "w") as df:
        df.write(raw_content.text)