package parser

import (
	"fmt"

	"github.com/tap8stry/orion/pkg/common"
	"github.com/tap8stry/orion/pkg/parser/dockerfile"
)

func GetBaseImages(filepath string) ([]common.Image, error) {
	/*
		parse dockerfile and return the base image in common.Image type
		type Image struct {
			Name      string    `json:"name"`
			Tag       string    `json:"tag"`
			OSName    string    `json:"os_name"`
			OSVersion string    `json:"os_version"`
			SHA256    string    `json:"sha256"`
			Metadata  string    `json:"metadata"`
			Packages  []Package `json:"packages"`
			Scanned   bool      `json:"scanned"`
		}
	*/
	base := []common.Image{}
	doc, err := dockerfile.GetDockerfile(filepath)
	if err != nil {
		fmt.Printf("\nError parsing base image: %s\n", err.Error())
		return base, err
	} else {
		for _, buildStage := range doc.BuildStages {
			base = append(base, buildStage.Image)
		}
		return base, nil
	}
}
