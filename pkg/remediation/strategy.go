package remediation

import (
	"github.com/everfix/pkg/config"
	"github.com/everfix/pkg/neo4j"
)

type Step struct {
	Op     config.StepOP
	Images []string
}

type Remediation []Step

// GetImageForFixing Get the Remediation image for fixing the vulnerability
// todo: new algorithm for remediation
func GetImageForFixing(relatedImages []string, imageTree *neo4j.ImageTreeNode) (string, error) {
	var fixImageName string
	fixImageName = relatedImages[0]
	baseImage, err := neo4j.GetBaseImage(fixImageName)
	if err != nil {
		return "", err
	}
	for baseImage != "" {
		if config.Contains(relatedImages, baseImage) {
			fixImageName = baseImage
		}
		baseImage, err = neo4j.GetBaseImage(baseImage)
		if err != nil {
			return "", err
		}
	}
	return fixImageName, nil
}
